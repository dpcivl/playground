# 1) π’΅ Convolutional Neural Network
μ €λ² MNIST μμ  κµ¬ν„ λ•λ” dense layerλ΅λ§ μ¶”λ΅ ν–μ—λ”λ°, (κ·ΈλΌμ—λ„ 97νΌμ„ΌνΈμ accuracy.. π…)  
μ΄λ²μ—λ” CNNμ„ ν•λ² μ‚¬μ©ν•΄λ³΄λ ¤κ³  ν•λ‹¤.  
μ†”μ§ν CNNμ€ μ•„μ§ λ°°μ°μ§€ μ•μ•λ”λ° μμ  κµ¬ν„ μ •λ„λ” ν•΄λ³΄λ” κ² μΆ‹μ„ κ±° κ°™κ³  Incepction v1 λ“± κΈ°μ΄ λ…Όλ¬Έλ“¤λ„ κµ¬ν„ν•΄λ³΄λ ¤λ©΄ μ§„λ„ κΈ°λ‹¤λ¦¬λ‹¤κ°€ ν• μ„Έμ›”μΌ κ±° κ°™μ•„μ„ λ¨Όμ € μ‹μ‘ν•λ‹¤.  

![image](https://github.com/dpcivl/playground/assets/95332280/7fdab492-dd1e-4123-8786-f08b7b1b4be2)  
(μ¶μ²: https://www.analyticsvidhya.com/blog/2022/01/convolutional-neural-network-an-overview/)

## 1.1> μ¶λ ¥ ν¬κΈ° κ³„μ‚° κ³µμ‹
- μ…λ ¥ ν¬κΈ°(I) : μ…λ ¥ λ μ΄μ–΄μ λ„λΉ„
- ν•„ν„° ν¬κΈ°(F) : μ»¨λ³Όλ£¨μ… ν•„ν„°(μ»¤λ„)μ λ„λΉ„
- μ¤νΈλΌμ΄λ“(S) : ν•„ν„°κ°€ μ…λ ¥ λ°μ΄ν„°λ¥Ό ν†µν•΄ μ΄λ™ν•λ” κ°„κ²©
- ν¨λ”©(P) : μ…λ ¥ λ°μ΄ν„° μ£Όλ³€μ— μ¶”κ°€λ 0μ λ‘κ»
- μ¶λ ¥ ν¬κΈ°(O) : ν•„ν„°λ¥Ό ν†µν•΄ μƒμ„±λλ” μ¶λ ¥ λ μ΄μ–΄μ λ„λΉ„

$$
O = {{I - F + 2P} \over S} +1
$$  

## 1.2> π¤” μ»¨λ³Όλ£¨μ… ν•„ν„°λ” μ–΄λ–»κ² μ¥λ§ν• κΉ?
### 1.2.1] ν•„ν„° ν¬κΈ°
μΌλ°μ μΌλ΅ μ‚¬μ©λλ” ν¬κΈ°λ” $3\times3$, $5\times5$μ΄λ‹¤.  
μ‘μ€ ν•„ν„°λ¥Ό μ—¬λ¬ μΈµμ— κ²Ήμ³ μ“λ” κ²ƒμ€ ν° ν•„ν„°λ¥Ό ν• κ° μ‚¬μ©ν•λ” κ²ƒλ³΄λ‹¤ λ” λ§μ€ λΉ„μ„ ν•μ„±μ„ λ¨λΈμ— μ¶”κ°€ν•κ³ , λ” λ³µμ΅ν• νΉμ§•μ„ ν•™μµν•  μ μκ² ν•λ‹¤.  

ν”„λ μ„μ›ν¬λ¥Ό μ‚¬μ©ν•μ§€ μ•κ³  ν•„ν„°λ¥Ό λ§λ“ λ‹¤λ©΄ μ•„λμ κ³Όμ •μ„ κ±°μΉλ‹¤.  
```
1. ν•„ν„°μ κ°€μ¤‘μΉλ¥Ό μλ™μΌλ΅ μ΄κΈ°ν™”
2. μ…λ ¥ μ΄λ―Έμ§€μ— λ€ν•΄ ν•©μ„±κ³± μ—°μ‚°
3. ν•„ν„° μ μ© λ° νΉμ§•λ§µ μƒμ„±
```
π”Ό μ„μ κ³Όμ •μ€ κΈ°λ³Έμ μΈ ν•„ν„°λ¥Ό μ„Έν…ν•λ” κ²ƒμ΄κ³ , μµμ ν™”κΉμ§€ ν•λ ¤λ©΄ λ” λ§μ€ κ³Όμ •λ“¤μ΄ ν¬ν•¨λλ‹¤.  

### 1.2.2] μ¤νΈλΌμ΄λ“
μ£Όλ΅ 1μ΄λ‚ 2λ¥Ό μ‚¬μ©ν•λ‹¤.  
μ¤νΈλΌμ΄λ“ 1μ€ μ…λ ¥κ³Ό μ¶λ ¥μ κ³µκ°„μ  ν¬κΈ°λ¥Ό μ μ§€ν•λ ¤κ³  ν•  λ• μ‚¬μ©λλ‹¤.  
μ¤νΈλΌμ΄λ“ 2λ” feature mapμ ν¬κΈ°λ¥Ό μ¤„μ΄κ³  λ¨λΈμ κ³„μ‚°λ‰μ„ κ°μ†μ‹ν‚¬ λ• μ‚¬μ©λλ‹¤.  

π’΅ κ³Όλ„ν• μ¤νΈλΌμ΄λ“λ” μ •λ³΄ μ†μ‹¤μ„ μ΄λν•  μ μλ‹¤.  

### 1.2.3] ν¨λ”©
- same ν¨λ”© : μ…λ ¥κ³Ό μ¶λ ¥μ κ³µκ°„μ  ν¬κΈ°λ¥Ό λ™μΌν•κ² μ μ§€ν•  λ• μ‚¬μ©
- valid ν¨λ”© : ν¨λ”© μ—†μ΄ μμν• μ…λ ¥ λ°μ΄ν„°λ§ μ‚¬μ©ν•κ³ μ ν•  λ• μ‚¬μ©

# 2) κµ¬ν„ μμ  λ„¤νΈμ›ν¬ λ¶„μ„
```python
# λ¨λΈ κµ¬μ„±
model = models.Sequential([
    # Conv2Dμ™€ MaxPooling2D λ μ΄μ–΄λ“¤
    layers.Conv2D(32, (3, 3), activation='relu', input_shape=(28, 28, 1)),
    layers.MaxPooling2D((2, 2)),
    layers.Conv2D(64, (3, 3), activation='relu'),
    layers.MaxPooling2D((2, 2)),
    layers.Conv2D(64, (3, 3), activation='relu'),
    
    # Dense λ μ΄μ–΄λ΅ λ„¤νΈμ›ν¬ μ™„μ„±
    layers.Flatten(),
    layers.Dense(64, activation='relu'),
    layers.Dense(10, activation='softmax')
])
```
## 2.1> β… λ μ΄μ–΄ ν¬κΈ° κ³„μ‚°ν•κΈ°
### 2.1.1] 1st conv layer
μ²«λ²μ§Έ conv layerμ ν•„ν„° ν¬κΈ°λ” $3\times3$μ΄κ³  32κ°μ ν•„ν„°λ¥Ό κ°€μ§„λ‹¤. μ¤νΈλΌμ΄λ“λ‚ ν¨λ”©μ€ λ”°λ΅ μ μ©ν•μ§€ μ•μ•κ³ , ν™μ„±ν™” ν•¨μλ΅λ” reluλ¥Ό μ‚¬μ©ν–λ‹¤.  

μ¶λ ¥ feature mapμ ν¬κΈ°λ¥Ό κ³„μ‚°ν•λ©΄ μ•„λμ™€ κ°™λ‹¤.  
$$
O = {{28 - 3 + 0} \over 1} +1 = 26
$$

μ¦‰, $26\times26\times32$κ°μ feature mapμ΄ μƒμ„±λλ‹¤.  

### 2.1.2] 1st max pooling layer
μ²«λ²μ§Έ max pooling layerμ—μ„ ν’€λ§ μλ„μ° ν¬κΈ°λ” $2\times2$μ΄λ‹¤.  
conv layerμ feature map ν¬κΈ°λ¥Ό κ³„μ‚°ν• κ²ƒκ³Ό κ°™μ΄ κ³„μ‚°ν•΄μ£Όλ©΄ μ¶λ ¥ feature mapμ„ μ• μ μλ‹¤.  

$$
O = {{26 - 2}\over 2} + 1 = 13
$$

π’΅ μ—¬κΈ°μ„ μ¤‘μ”ν• κ²ƒμ€ max pooling layerλ¥Ό κµ¬μ„±ν•  λ• λ³„λ‹¤λ¥Έ μ •μκ°€ μ—†μΌλ©΄, ν’€λ§ μλ„μ°μ ν¬κΈ°μ™€ κ°™μ€ κ°’μΌλ΅ μ¤νΈλΌμ΄λ“λ¥Ό μ •μν•λ‹¤λ” κ²ƒμ΄λ‹¤. μ΄λ΅ μΈν•΄μ„ pooling layerλ” feature mapμ spatial sizeλ¥Ό λ°μΌλ΅ μ¤„μ΄λ” ν¨κ³Όλ¥Ό κ°€μ§„λ‹¤.  

μ–΄μ¨κ±°λ‚, max pooling layerλ¥Ό ν†µκ³Όν• ν›„μ feature mapμ ν¬κΈ°λ” $13\times13\times26$μ΄ λλ‹¤.  

### 2.1.3] μ΄ν›„ λ μ΄μ–΄
- 2λ²μ§Έ conv layerλ¥Ό μ§€λ‚ ν›„ β΅οΈ $10 \times 10 \times 64$
$$
O = {{13 - 3} \over 1} + 1 = 10
$$
- 2λ²μ§Έ max pooling layerλ¥Ό μ§€λ‚ ν›„ β΅οΈ $5 \times 5 \times 64$
$$
O = {{10 - 2} \over 2} + 1 = 5
$$
- 3λ²μ§Έ conv layerλ¥Ό μ§€λ‚ ν›„ β΅οΈ $3 \times 3 \times 64$
$$
O = {{5 - 3} \over 1} + 1 = 3
$$
- flattening β΅οΈ 576κ°μ λ‰΄λ°μ΄ μƒμ„±
$$
3 \times 3 \times 64 = 576
$$
- 1λ²μ§Έ dense layerλ¥Ό μ§€λ‚ ν›„ β΅οΈ 64κ°μ λ‰΄λ°μ΄ μƒμ„±
- 2λ²μ§Έ dense layerλ¥Ό μ§€λ‚ ν›„ β΅οΈ 10κ°μ λ‰΄λ°μ΄ μƒμ„±

# 3) Dense Networkμ™€ CNN λΉ„κµ
# 3.1> νλΌλ―Έν„° κ°μ κ³„μ‚°
1. Dense layer  
π”½ μ•„λλ” Dense layerμ νλΌλ―Έν„° κ°μλ¥Ό κµ¬ν•λ” κ³µμ‹μ΄λ‹¤.  
$$
P = (I + 1) \times O \\
P: νλΌλ―Έν„°\space κ°μ \\
I : μ…λ ¥\spaceμ λ‹›\spaceμ \\
O : μ¶λ ¥\spaceμ λ‹›\spaceμ
$$

- μ²«λ²μ§Έ Dense layer
  - μ…λ ¥ μ λ‹› μ:784(input_shape)
  - μ¶λ ¥ μ λ‹› μ:256
  - νλΌλ―Έν„° κ°μ:$(784+1) \times 256=200960$
- λ‘λ²μ§Έ Dense layer
  - μ…λ ¥ μ λ‹› μ:256(μ΄μ „ λ μ΄μ–΄ μ¶λ ¥ μ λ‹› μ)
  - μ¶λ ¥ μ λ‹› μ:128
  - νλΌλ―Έν„° κ°μ:$(256+1) \times 128 = 32896$
- μ„Έλ²μ§Έ Dense layer
  - μ…λ ¥ μ λ‹› μ:128
  - μ¶λ ¥ μ λ‹› μ:10
  - νλΌλ―Έν„° κ°μ:$(128+1) \times 10 = 1290$

μ΄ 235,146κ°μ νλΌλ―Έν„°.  

2. Convolutional layer  
π”½ μ•„λλ” Convolutional layerμ νλΌλ―Έν„° κ°μλ¥Ό κµ¬ν•λ” κ³µμ‹μ΄λ‹¤.  
$$
P = (H \times W \times C + 1) \times K \\
P : νλΌλ―Έν„° \space κ°μ \\
H : ν•„ν„° \space λ†’μ΄ \\
W : ν•„ν„° \space λ„λΉ„ \\
C : μ…λ ¥ \space μ±„λ„ \\
K : μ»¤λ„ \space κ°μ
$$

- μ²«λ²μ§Έ conv layer
  - μ…λ ¥ μ±„λ„ μ : $1$ (MNIST μμ  = ν‘λ°±)
  - ν•„ν„° ν¬κΈ° : $3 \times 3$
  - ν•„ν„° κ°μ : $32$
  - νλΌλ―Έν„° κ°μ : $(3\times3\times1+1)\times32=320$
- λ‘λ²μ§Έ conv layer
  - μ…λ ¥ μ±„λ„ μ : $32$ (μ΄μ „ λ μ΄μ–΄μ ν•„ν„° μ)
  - ν•„ν„° ν¬κΈ° : $3\times 3$
  - ν•„ν„° κ°μ : $64$
  - νλΌλ―Έν„° κ°μ : $(3\times3\times32+1)\times64=18496$
- μ„Έλ²μ§Έ conv layer
  - μ…λ ¥ μ±„λ„ μ : $64$
  - ν•„ν„° ν¬κΈ° : $3\times3$
  - ν•„ν„° κ°μ : $64$
  - νλΌλ―Έν„° κ°μ : $(3\times3\times64+1)\times64=36928$
- Flatten ν›„ $3\times3\times64=576$
- μ²«λ²μ§Έ dense layer
  - μ…λ ¥ μ λ‹› μ : 576
  - μ¶λ ¥ μ λ‹› μ : 64
  - νλΌλ―Έν„° κ°μ : $(576+1) \times 64=36928$
- λ‘λ²μ§Έ dense layer
  - μ…λ ¥ μ λ‹› μ : 64
  - μ¶λ ¥ μ λ‹› μ : 10
  - νλΌλ―Έν„° κ°μ : $(64+1) \times 10 = 650$

μ΄ 93,322κ°μ νλΌλ―Έν„°.

**κΉμ€ κ±΄ CNNμ΄ λ” κΉμ€λ° Dense Networkλ³΄λ‹¤ νλΌλ―Έν„°λ” μ λ‹¤!! π‘**  

